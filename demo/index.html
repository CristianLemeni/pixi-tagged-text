<!DOCTYPE html>
<html>
  <head>
    <title>Pixi MultiStyle Text Demo</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css" />

    <script src="./pixi.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.3.8/pixi.js"></script> -->
    <script src="./highlight.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script> -->

    <!-- RichText -->
    <script src="../dist/pixi-rich-text.umd.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
  </head>

  <body>
    <h1>Pixi Multistyle Text Demo</h1>
    <main>
      <script>
        const opt = { debug: false };

        function createPixiApp(
          id,
          width = 600,
          height = 600,
          backgroundColor = 0x333333
        ) {
          PIXI.settings.RESOLUTION = 2;
          const app = new PIXI.Application({ width, height, backgroundColor });
          document.getElementById(id).appendChild(app.view);

          return app;
        }

        function createDemo(id, richTextExample) {
          const app = createPixiApp(id);

          if (richTextExample !== undefined) {
            richTextExample.x = 30;
            richTextExample.y = 30;
            app.stage.addChild(richTextExample);
          }

          return app;
        }
      </script>

      <div class="example">
        <div class="code">
          <h2>Basics</h2>
          <pre><code class="js"></code></pre>
        </div>

        <div class="pixi" id="basic">
          <script>
            // Basics
            const basicText = `Let's make some
<ml>multiline</ml>
and <ms>multistyle</ms> text for
<pixi>Pixi.js!</pixi>`;
            const basicStyle = {
              default: {
                fontFamily: "Arial",
                fontSize: "24px",
                fill: "#cccccc",
                align: "center",
              },
              ml: {
                fontStyle: "italic",
                fill: "#ff8888",
              },
              ms: {
                fontWeight: "bold",
                fill: "#4488ff",
              },
              pixi: {
                fontSize: "64px",
                fill: "#efefef",
              },
            };

            const basic = new RichText(
              basicText,
              basicStyle,

              { debug: true }
            );

            createDemo("basic", basic);
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Inline images</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="img">
          <script>
                      const thinking = PIXI.Sprite.from("./icon.png");
                      const doot = PIXI.Sprite.from("./doot.png");

                      const imgText = `<h2>Inline Images!</h2>
            Add an image.
            <img imgSrc="doot" imgDisplay="inline" />
            Or, put an icon <thinking imgDisplay="icon" /> in there, bro!
            `,
                      const imgStyle = {
                        default: {
                          fontFamily: "Arial",
                          fontSize: "24px",
                          fill: "#FFFFCC",
                          align: "center",
                        },
                        h2: {
                          fontSize: 36,
                          fill: "#44CC99",
                        },
                        img: {},
                        icon: {},
                      };

                      const imgRichText = new RichText(
                        imgText,
                        imgStyle,
                        {
                          debug: true,
                          imgMap: { thinking, doot },
                        }
                      );

                      const imgApp = createDemo("img", imgRichText);
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Alignment</h2>
          <pre><code class="js">
      </code></pre>
        </div>
        <div class="pixi" id="align">
          <script>
            // Alignment.
            const alignText = `You can align left, right, center or justify.\nEt veniam nemo sunt ab facilis voluptatem voluptas est debitis.`;
            const alignStyle = {
              default: {
                wordWrapWidth: 250,
              },
              b: {
                fontWeight: "700",
                fill: "white",
              },
            };

            let left = new RichText(
              alignText.replace("left", "<b>left</b>"),
              {
                ...alignStyle,
                default: {
                  align: "left",
                  fill: "teal",
                },
              },
              opt
            );

            let right = new RichText(
              alignText.replace("right", "<b>right</b>"),
              {
                ...alignStyle,
                default: {
                  align: "right",
                  fill: "orange",
                },
              },
              opt
            );
            right.x = 330;
            right.y = 30;

            let center = new RichText(
              alignText.replace("center", "<b>center</b>"),
              {
                ...alignStyle,
                default: {
                  align: "center",
                  fill: "yellow",
                },
              },
              opt
            );
            center.x = 30;
            center.y = 330;

            let justify = new RichText(
              alignText.replace("justify", "<b>justify</b>"),
              {
                ...alignStyle,
                default: {
                  align: "justify",
                  fill: "pink",
                },
              },
              opt
            );
            justify.x = 330;
            justify.y = 330;

            const alignApp = createDemo("align", left);
            alignApp.stage.addChild(right);
            alignApp.stage.addChild(center);
            alignApp.stage.addChild(justify);
          </script>
        </div>
      </div>

      <div class="example">
        <div class="code">
          <h2>Vertical Alignment</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="valign">
          <script>
            // Vertical Alignment
            const valignText = `<top><code>Top</code> <small>Vertical</small> <img/> Alignment.</top>

<middle><code>Middle</code> <small>Vertical</small> <img/> Alignment.</middle>

<bottom><code>Bottom</code> <small>Vertical</small> <img/> Alignment.</bottom>

<baseline><code>Baseline</code> <small>Vertical</small> <img/> Alignment.</baseline>`;

            const valignStyle = {
              default: {
                fontFamily: "Arial",
                fontSize: "24px",
                fill: "#cccccc",
                align: "left",
                valign: "baseline",
              },
              code: {
                fontFamily: "Courier",
                fontSize: "36px",
                fill: "#ff8888",
              },
              small: { fontSize: "14px" },
              top: { valign: "top" },
              middle: { valign: "middle" },
              bottom: { valign: "bottom" },
              baseline: { valign: "baseline" },
              img: { imgSrc: "valignImg", imgDisplay: "icon" },
            };

            const valignImg = PIXI.Sprite.from("./icon.png");

            let valign = new RichText(valignText, valignStyle, {
              imgMap: { valignImg },
              debug: true,
            });
            createDemo("valign", valign);
          </script>
        </div>
      </div>

      <div class="example">
        <div class="code">
          <h2>Attributes</h2>
          <pre><code class="js">
          </code></pre>
        </div>
        <div class="pixi" id="attributes">
          <script>
            // Basics
            const attributesText = `You can add <em>attributes</em> to your tags!\nThey will <em fontStyle="italic">overwrite</em> the <em fill="#FF8822">values</em><br></br>for any existing <em fontFamily="Courier" fill="#FFFF00" fontWeight="400">tag styles</em>.`;
            const attributesStyle = {
              default: {
                fontFamily: "Arial",
                fontSize: "24px",
                fill: "#cccccc",
                align: "left",
              },
              em: {
                fill: "#4488FF",
                fontWeight: 700,
              },
            };
            let attributes = new RichText(attributesText, attributesStyle);

            createDemo("attributes", attributes);
          </script>
        </div>
      </div>

      <div class="example">
        <div class="code">
          <h2>Nesting Tags</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="nested">
          <script>
            // Nesting Tags
            const nestedText = `You can <outline>nest <b>tags <red>as <i>deeply <thicker>as <shadow>you'd <large>like, dawg!</large></shadow></thicker></i></red></b></outline>`;
            const nestedStyle = {
              default: {
                fontFamily: "Arial",
                fontSize: "24px",
                fill: "#cccccc",
                wordWrapWidth: 500,
                wordWrap: true,
                valign: "baseline",
              },
              outline: { stroke: "black", strokeThickness: 2 },
              b: { fontWeight: 700 },
              red: { fill: "#ff8888" },
              i: { fontStyle: "italic" },
              thicker: { strokeThickness: 6 },
              shadow: { dropShadow: true, dropShadowColor: "#888888" },
              large: { fontSize: "36px" },
            };
            let nested = new RichText(nestedText, nestedStyle);
            createDemo("nested", nested);
          </script>
        </div>
      </div>

      <div class="example">
        <div class="code">
          <h2>Spacing</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="spacing">
          <script>
            // Spacing
            const spacingText =
              "You can set line and letter spacing to give your text some drama. Note that lineSpacing can only be set on the default style.";
            const spacingStyle = {
              default: {
                fontFamily: "Arial",
                fontSize: "24px",
                fill: "#cccccc",
                lineSpacing: 10,
                letterSpacing: 10,
                wordWrap: true,
                wordWrapWidth: 500,
              },
            };
            let spacing = new RichText(spacingText, spacingStyle);

            createDemo("spacing", spacing);
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Wrapping and Alignment</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="wrapping">
          <script>
            // Wrapping and Alignment
            const wrappingText =
              'Global word wrap and alignment properties are controlled by the "default" style, and can\'t be overridden by other styles.';
            const wrappingStyle = {
              default: {
                fontFamily: "Arial",
                fontSize: "24px",
                fill: "#cccccc",
                wordWrap: true,
                wordWrapWidth: 150,
                align: "right",
              },
            };
            let wrapping = new RichText(wrappingText, wrappingStyle);
            createDemo("wrapping", wrapping);
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Wrapping and Alignment II - splitStyle = "characters"</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="wrapping2">
          <script>
            // Wrapping and Alignment II
            const wrappingText2 = `Use splitStyle:"character" to allow line breaks between characters.
全局设置的<blue>对齐</blue>属性由「默认」来<big>控制</big>。而且不能被<blue>别的样式</blue>所<red>覆盖</red>。`;
            const wrappingStyle2 = {
              default: {
                fontFamily: "Arial",
                fontSize: "16px",
                fill: "#cccccc",
                wordWrap: true,
                wordWrapWidth: 250,
                breakWords: true,
              },
              blue: { fill: 0x4488ff, stroke: 0x2244cc, fontSize: "24px" },
              red: { fill: 0xff8888, stroke: 0xcc4444 },
              big: { fill: 0x88ff88, stroke: 0x44cc44, fontSize: "36px" },
            };

            let richTextWrapping2 = new RichText(
              wrappingText2,
              wrappingStyle2,
              {
                splitStyle: "characters",
              }
            );
            createDemo("wrapping2", richTextWrapping2);
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Debug Mode</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="debug">
          <script>
            // Debug Mode
            const debugText =
              "You can use <blue>debug mode</blue> to help you figure out what your text is doing. Include <code>{debug: true} </code> in the options when you create your text.";
            const debugStyle = {
              default: {
                fontFamily: "Arial",
                fontSize: "24px",
                fill: "#cccccc",
                wordWrap: true,
                wordWrapWidth: 500,
              },
              blue: {
                fill: "#4488ff",
                stroke: "#2244cc",
                strokeThickness: 4,
              },
              code: {
                fontFamily: "Courier",
                fontSize: "36px",
                fill: "#ff8888",
                stroke: "#660000",
                strokeThickness: 8,
              },
            };

            let debug = new RichText(debugText, debugStyle, { debug: false });

            createDemo("debug", debug);
          </script>
        </div>
      </div>
      <!--div class="example">
        <div class="code">
          <h2>Interaction Events</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="interaction">
          <script>
            // Interaction Events
            let interactionRich = new RichText(
              `If you enable <link name="interaction">interaction</link>, you can get <link name="information">information</link> about which <link name="tag">tag</link> corresponded to the <link name="event">event</link>.`,
              {
                default: {
                  fontFamily: "Arial",
                  fontSize: "24px",
                  fill: "#cccccc",
                  wordWrap: true,
                  wordWrapWidth: 500,
                },
                link: {
                  fill: 0x4488ff,
                  fontStyle: "italic",
                },
              }
            );

            interactionRich.text = "Interactivity is not currently supported.";
            interactionRich.interactive = true;
            interactionRich.on("pointerdown", (e) => {
              if (e.targetTag !== undefined && e.targetTag.name === "link") {
                alert(
                  `You clicked on the link for "${e.targetTag.properties.name}"!`
                );
              }
            });

            createDemo("interaction", interactionRich);
          </script>
        </div>
      </div-->
      <div class="example">
        <div class="code">
          <h2>Animation</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="animated">
          <script>
            // Animation
            const animatedText =
              "Now have fun making some\n<blue>B E A U T I F U L</blue>\n<red>multistyle</red>\ntext!";
            let animatedStyles = {
              default: {
                fontFamily: "Recursive, Arial",
                fontSize: "48px",
                fontWeight: 900,
                fill: "#cccccc",
                strokeThickness: 1,
                stroke: "#aaaaaa",
                dropShadow: true,
                dropShadowBlur: 15,
                dropShadowDistance: 15,
                dropShadowAngle: 0,
                wordWrapWidth: 500,
                lineSpacing: 40,
                align: "center",
              },
              blue: {
                fill: 0x4488ff,
                stroke: 0x2244cc,
                fontSize: 22,
              },
              red: { fill: 0xff8888, stroke: 0xcc4444 },
            };

            let animated = new RichText(animatedText, animatedStyles, {
              splitStyle: "characters",
            });

            const app = createDemo("animated", animated);

            // Animate
            const originalYPositions = animated.textFields.map((t) => t.y);
            let time = 0;

            const applySineWaveToYPositionOfText = (text, i, time) => {
              text.y = originalYPositions[i] + Math.sin(time / 10 + i) * 10;
            };

            const animationStep = (delta) => {
              time += delta;
              for (let i = 0; i < animated.textFields.length; i++) {
                const text = animated.textFields[i];
                applySineWaveToYPositionOfText(text, i, time);
              }
            };
            app.ticker.add(animationStep);
          </script>
        </div>
      </div>
    </main>
  </body>
</html>
