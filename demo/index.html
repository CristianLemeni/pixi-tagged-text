<!DOCTYPE html>
<html>
  <head>
    <title>Pixi MultiStyle Text Demo</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="style.css" />

    <script src="./pixi.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.3.8/pixi.js"></script> -->
    <script src="./highlight.min.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script> -->

    <!-- RichText -->
    <script src="../dist/pixi-rich-text.umd.js"></script>
    <!-- Old MultiStyleText -->
    <script src="./pixi-multistyle-text.umd.js"></script>
    <script>
      hljs.initHighlightingOnLoad();
    </script>
  </head>

  <body>
    <h1>Pixi Multistyle Text Demo</h1>
    <main>
      <script>
        const opt = { debug: false };

        function createPixiApp(
          id,
          width = 600,
          height = 600,
          backgroundColor = 0x333333
        ) {
          PIXI.settings.RESOLUTION = 2;
          const app = new PIXI.Application({ width, height, backgroundColor });
          document.getElementById(id).appendChild(app.view);

          return app;
        }

        function createDemo(
          id,
          richTextExample,
          multiStyleTextExample = undefined
        ) {
          const app = createPixiApp(id);

          if (richTextExample !== undefined) {
            richTextExample.x = 30;
            richTextExample.y = 30;
            app.stage.addChild(richTextExample);
          }

          if (multiStyleTextExample !== undefined) {
            multiStyleTextExample.x = 30;
            multiStyleTextExample.y = 30;
            multiStyleTextExample.alpha = 0.5;
            multiStyleTextExample.visible = false;
            app.stage.addChild(multiStyleTextExample);
          }

          return app;
        }

        // For testing purposes, temporarily replace the code that creates
        // text fields to create two of them to compare against each other.
        function createComparisonText(text, styles, overrideOptions) {
          return [
            new RichText(text, styles, overrideOptions || opt),
            new MultiStyleText(text, styles),
          ];
        }
      </script>

      <div class="example">
        <div class="code">
          <h2>Basics</h2>
          <pre><code class="js"></code></pre>
        </div>

        <div class="pixi" id="basic">
          <script>
            // Basics
            const basic = createComparisonText(
              `Let's make some
<ml>multiline</ml>
and <ms>multistyle</ms> text for
<pixi>Pixi.js!</pixi>`,
              {
                default: {
                  fontFamily: "Arial",
                  fontSize: "24px",
                  fill: "#cccccc",
                  align: "center",
                },
                ml: {
                  fontStyle: "italic",
                  fill: "#ff8888",
                },
                ms: {
                  fontWeight: "bold",
                  fill: "#4488ff",
                },
                pixi: {
                  fontSize: "64px",
                  fill: "#efefef",
                },
              }
            );

            createDemo("basic", ...basic, { debug: true });
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Inline images</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="img">
          <script>
            const thinking = PIXI.Sprite.from("./icon.png");
            const doot = PIXI.Sprite.from("./doot.png");

            const imgStyle = {
              default: {
                fontFamily: "Arial",
                fontSize: "24px",
                fill: "#FFFFCC",
                align: "center",
              },
              h2: {
                fontSize: 36,
                fill: "#44CC99",
              },
              img: {},
              icon: {},
            };

            const [imgRichText, imgMultiText] = createComparisonText(
              `<h2>Inline Images!</h2>
Add an image.
<img imgSrc="doot" imgDisplay="inline" />
Or, put an icon <thinking imgDisplay="icon" /> in there, bro!
`,
              imgStyle,
              {
                debug: true,
                imgMap: { thinking, doot },
              }
            );
            imgMultiText.text = "Images not supported in multiText";

            const imgApp = createDemo("img", imgRichText, imgMultiText);
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Alignment</h2>
          <pre><code class="js">
      </code></pre>
        </div>
        <div class="pixi" id="align">
          <script>
            // Alignment.
            const str = `You can align left, right, center or justify.\nEt veniam nemo sunt ab facilis voluptatem voluptas est debitis.`;
            const style = {
              default: {
                align: "left",
                fill: "teal",
                wordWrapWidth: 250,
              },
              b: {
                fontWeight: "700",
                fill: "white",
              },
            };

            let [leftRich, leftMulti] = createComparisonText(
              str.replace("left", "<b>left</b>"),
              style,
              opt
            );

            let right = new RichText(
              str.replace("right", "<b>right</b>"),
              {
                ...style,
                default: {
                  align: "right",
                  fill: "orange",
                  wordWrapWidth: 250,
                },
              },
              opt
            );
            right.x = 330;
            right.y = 30;

            let center = new RichText(
              str.replace("center", "<b>center</b>"),
              {
                ...style,
                default: {
                  align: "center",
                  fill: "yellow",
                  wordWrapWidth: 250,
                },
              },
              opt
            );
            center.x = 30;
            center.y = 330;

            let justify = new RichText(
              str.replace("justify", "<b>justify</b>"),
              {
                ...style,
                default: {
                  align: "justify",
                  fill: "pink",
                  wordWrapWidth: 250,
                },
              },
              opt
            );
            justify.x = 330;
            justify.y = 330;

            const alignApp = createDemo("align", leftRich, leftMulti);
            alignApp.stage.addChild(right);
            alignApp.stage.addChild(center);
            alignApp.stage.addChild(justify);
          </script>
        </div>
      </div>

      <div class="example">
        <div class="code">
          <h2>Vertical Alignment</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="valign">
          <script>
            // Vertical Alignment
            const valignStyle = {
              default: {
                fontFamily: "Arial",
                fontSize: "24px",
                fill: "#cccccc",
                align: "left",
                valign: "baseline",
              },
              code: {
                fontFamily: "Courier",
                fontSize: "36px",
                fill: "#ff8888",
              },
              small: { fontSize: "14px" },
              top: { valign: "top" },
              middle: { valign: "middle" },
              bottom: { valign: "bottom" },
              baseline: { valign: "baseline" },
              img: { imgSrc: "valignImg", imgDisplay: "icon" },
            };
            const valignImg = PIXI.Sprite.from("./icon.png");
            let valign = createComparisonText(
              `<top><code>Top</code> <small>Vertical</small> <img/> Alignment.</top>

<middle><code>Middle</code> <small>Vertical</small> <img/> Alignment.</middle>

<bottom><code>Bottom</code> <small>Vertical</small> <img/> Alignment.</bottom>

<baseline><code>Baseline</code> <small>Vertical</small> <img/> Alignment.</baseline>`,
              valignStyle,
              { imgMap: { valignImg }, debug: true }
            );
            createDemo("valign", ...valign);
          </script>
        </div>
      </div>

      <div class="example">
        <div class="code">
          <h2>Attributes</h2>
          <pre><code class="js">
          </code></pre>
        </div>
        <div class="pixi" id="attributes">
          <script>
            // Basics
            let attributes = createComparisonText(
              `You can add <em>attributes</em> to your tags!\nThey will <em fontStyle="italic">overwrite</em> the <em fill="#FF8822">values</em><br></br>for any existing <em fontFamily="Courier" fill="#FFFF00" fontWeight="400">tag styles</em>.`,
              {
                default: {
                  fontFamily: "Arial",
                  fontSize: "24px",
                  fill: "#cccccc",
                  align: "left",
                },
                em: {
                  fill: "#4488FF",
                  fontWeight: 700,
                },
              }
            );

            createDemo("attributes", ...attributes);
          </script>
        </div>
      </div>

      <div class="example">
        <div class="code">
          <h2>Nesting Tags</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="nested">
          <script>
            // Nesting Tags
            let nested = createComparisonText(
              "You can <outline>nest <b>tags <red>as <i>deeply <thicker>as <shadow>you'd <large>like, dawg!</large></shadow></thicker></i></red></b></outline>",
              {
                default: {
                  fontFamily: "Arial",
                  fontSize: "24px",
                  fill: "#cccccc",
                  wordWrapWidth: 500,
                  wordWrap: true,
                  valign: "baseline",
                },
                outline: { stroke: "black", strokeThickness: 2 },
                b: { fontWeight: 700 },
                red: { fill: "#ff8888" },
                i: { fontStyle: "italic" },
                thicker: { strokeThickness: 6 },
                shadow: { dropShadow: true, dropShadowColor: "#888888" },
                large: { fontSize: "36px" },
              }
            );
            createDemo("nested", ...nested);
          </script>
        </div>
      </div>

      <div class="example">
        <div class="code">
          <h2>Spacing</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="spacing">
          <script>
            // Spacing
            let spacing = createComparisonText(
              "You can set line and letter spacing to give your text some drama. Note that lineSpacing can only be set on the default style.",
              {
                default: {
                  fontFamily: "Arial",
                  fontSize: "24px",
                  fill: "#cccccc",
                  lineSpacing: 10,
                  letterSpacing: 10,
                  wordWrap: true,
                  wordWrapWidth: 500,
                },
              }
            );

            createDemo("spacing", ...spacing);
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Wrapping and Alignment</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="wrapping">
          <script>
            // Wrapping and Alignment
            let wrapping = createComparisonText(
              'Global word wrap and alignment properties are controlled by the "default" style, and can\'t be overridden by other styles.',
              {
                default: {
                  fontFamily: "Arial",
                  fontSize: "24px",
                  fill: "#cccccc",
                  wordWrap: true,
                  wordWrapWidth: 150,
                  align: "right",
                },
              }
            );
            createDemo("wrapping", ...wrapping);
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Wrapping and Alignment II</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="wrapping2">
          <script>
            // Wrapping and Alignment II
            let [richTextWrapping2, multiStyleWrapping2] = createComparisonText(
              "全局设置的<blue>对齐</blue>属性由「默认」来<big>控制</big>。而且不能被<blue>别的样式</blue>所<red>覆盖</red>。",
              {
                default: {
                  fontFamily: "Arial",
                  fontSize: "16px",
                  fill: "#cccccc",
                  wordWrap: true,
                  wordWrapWidth: 250,
                  breakWords: true,
                },
                blue: { fill: 0x4488ff, stroke: 0x2244cc, fontSize: "24px" },
                red: { fill: 0xff8888, stroke: 0xcc4444 },
                big: { fill: 0x88ff88, stroke: 0x44cc44, fontSize: "36px" },
              }
            );
            richTextWrapping2.text = "breakWords is not currently supported.";
            createDemo("wrapping2", richTextWrapping2, multiStyleWrapping2);
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Debug Mode</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="debug">
          <script>
            // Debug Mode
            let debug = createComparisonText(
              "You can use <blue>debug mode</blue> to help you figure out what your text is doing. Include <code>{debug: true} </code> in the options when you create your text.",
              {
                default: {
                  fontFamily: "Arial",
                  fontSize: "24px",
                  fill: "#cccccc",
                  wordWrap: true,
                  wordWrapWidth: 500,
                },
                blue: {
                  fill: "#4488ff",
                  stroke: "#2244cc",
                  strokeThickness: 4,
                },
                code: {
                  fontFamily: "Courier",
                  fontSize: "36px",
                  fill: "#ff8888",
                  stroke: "#660000",
                  strokeThickness: 8,
                },
              },
              { debug: false }
            );

            MultiStyleText.debugOptions.spans.enabled = true;
            MultiStyleText.debugOptions.objects.enabled = true;

            createDemo("debug", ...debug);

            MultiStyleText.debugOptions.spans.enabled = false;
            MultiStyleText.debugOptions.objects.enabled = false;
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Interaction Events</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="interaction">
          <script>
            // Interaction Events
            let [interactionRich, interactionMulti] = createComparisonText(
              `If you enable <link name="interaction">interaction</link>, you can get <link name="information">information</link> about which <link name="tag">tag</link> corresponded to the <link name="event">event</link>.`,
              {
                default: {
                  fontFamily: "Arial",
                  fontSize: "24px",
                  fill: "#cccccc",
                  wordWrap: true,
                  wordWrapWidth: 500,
                },
                link: {
                  fill: 0x4488ff,
                  fontStyle: "italic",
                },
              }
            );

            interactionRich.text = "Interactivity is not currently supported.";

            interactionMulti.interactive = true;
            interactionMulti.on("pointerdown", (e) => {
              if (e.targetTag !== undefined && e.targetTag.name === "link") {
                alert(
                  `You clicked on the link for "${e.targetTag.properties.name}"!`
                );
              }
            });

            createDemo("interaction", interactionRich, interactionMulti);
          </script>
        </div>
      </div>
      <div class="example">
        <div class="code">
          <h2>Have Fun</h2>
          <pre><code class="js"></code></pre>
        </div>
        <div class="pixi" id="animated">
          <script>
            // Have Fun
            let funStyles = {
              default: {
                fontFamily: "Recursive, Arial",
                fontSize: "48px",
                fontWeight: 900,
                fill: "#cccccc",
                strokeThickness: 1,
                stroke: "#aaaaaa",
                dropShadow: true,
                dropShadowBlur: 15,
                dropShadowDistance: 15,
                dropShadowAngle: 0,
                wordWrapWidth: 500,
                lineSpacing: 40,
                align: "center",
              },
              blue: {
                fill: 0x4488ff,
                stroke: 0x2244cc,
                fontSize: 22,
              },
              red: { fill: 0xff8888, stroke: 0xcc4444 },
            };

            let [animatedRich, animatedMulti] = createComparisonText(
              "Now have fun making some\n<blue>B E A U T I F U L</blue>\n<red>multistyle</red>\ntext!",
              funStyles
            );

            const app = createDemo("animated", animatedRich, animatedMulti);

            const originalY = animatedRich.textFields.map((t) => t.y);
            let time = 0;

            // Animate
            const animate = (delta) => {
              time += delta;
              animatedRich.textFields.map((t, i) => {
                t.y = originalY[i] + Math.sin(time / 10 + i) * 10;
              });
            };
            app.ticker.add(animate);
          </script>
        </div>
      </div>
    </main>
  </body>
</html>
